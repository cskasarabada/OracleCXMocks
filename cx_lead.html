<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MiConnex Lead Workspace</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body class="lead-landing">

<header class="miconnex-bar">
  <div class="logo-mark"><span class="logo-strong">Mi</span>CONNEX</div>
  <div class="bar-actions">
    <button class="ghost-btn small">Help</button>
    <button class="ghost-btn small">Support</button>
    <div class="avatar-chip">CK</div>
  </div>
</header>

<main class="lead-shell">
  <section class="lead-create-row">
    <article class="lead-list-card">
      <div class="list-header">
        <div>
          <p class="eyebrow">My Open Leads</p>
          <h1>Lead Workspace</h1>
          <p class="muted">Try searching by keyword or add a filter</p>
        </div>
        <div class="list-actions">
          <span class="filter-chip">Status (3)</span>
          <span class="filter-chip">Record Set (Own)</span>
          <button class="ghost-btn" id="add-new-lead-btn">Create Lead</button>
        </div>
      </div>
      <div class="filter-bar">
        <input type="search" placeholder="Search leads"/>
        <button class="ghost-btn">Add Filter</button>
      </div>
      <div class="results-meta" id="lead-results-count">0 Results</div>
      <div id="leads-preview" class="table-shell"></div>
    </article>

    <article id="lead-form-card" class="lead-create-card">
      <div class="lead-form-header">
        <h2>Create Lead</h2>
        <p class="muted">Primary Contact - Related Contacts</p>
      </div>
      <div class="smartbar lead-smart">
        <div class="group">
          <button class="btn" onclick="RWD.actLead('Log Call')">Log Call</button>
          <button class="btn" onclick="RWD.actLead('Send Email')">Send Email</button>
          <button class="btn" onclick="RWD.actLead('Schedule Meeting')">Schedule Meeting</button>
          <button class="btn" onclick="RWD.actLead('Create Task')">Create Task</button>
        </div>
        <div class="smart-select">
          <label for="smart-action-select" class="visually-hidden">Smart Action</label>
          <select id="smart-action-select">
            <option value="">- Smart actions -</option>
            <option>Log Call</option>
            <option>Send Email</option>
            <option>Schedule Meeting</option>
            <option>Create Task</option>
            <option>Create Quote</option>
            <option>Assign Owner</option>
            <option>Add Note</option>
            <option>Create Pursuit</option>
            <option>Push to CPQ</option>
          </select>
          <button type="button" class="btn" id="apply-smart-action">Apply</button>
        </div>
        <div class="smart-input">
          <input id="smart-action-input" type="search" aria-haspopup="listbox" aria-expanded="false" placeholder="Smart Action (click to browse)"/>
          <div id="smart-action-pop" class="action-pop" role="listbox" aria-labelledby="smart-action-input" style="display:none"></div>
        </div>
      </div>

      <form id="addLeadForm" class="lead-form">
        <div class="row">
          <label>Company<input name="company" required></label>
          <label>Lead Name<input name="name"></label>
        </div>
        <div class="row">
          <label>Primary Contact<input name="contact"></label>
          <label>Job Title<input name="title"></label>
        </div>
        <div class="row">
          <label>Contact Phone<input name="phone"></label>
          <label>Contact Email<input name="email" type="email"></label>
        </div>
        <div class="row">
          <label>Source<input name="source"></label>
          <label>Owner<input name="owner" value="Chandra Kasarabada"></label>
        </div>
        <div class="row">
          <label>Fit Score<input name="score" type="number" min="0" max="100" value="60"></label>
          <label>Status<select name="status"><option>Qualified</option><option>Unqualified</option><option>Working</option></select></label>
        </div>
        <div class="row">
          <label>Country<input name="country"></label>
          <label>Rank<input name="rank"></label>
        </div>
        <div class="row">
          <label>Address Line 1<input name="address1"></label>
          <label>Address Line 2<input name="address2"></label>
        </div>
        <div class="row">
          <label>City<input name="city"></label>
          <label>State<input name="state"></label>
        </div>
        <div class="actions">
          <button class="btn primary" type="submit">Save Lead</button>
          <button class="btn" type="button" onclick="closeAddLead()">Cancel</button>
        </div>
      </form>
    </article>
  </section>

  <section class="lead-overview">
    <div class="lead-hero-card">
      <div>
        <p class="eyebrow">My Open Leads</p>
        <h2 id="leadHeroTitle">Sample Test Lead - 20250910</h2>
        <div class="hero-meta">
          <span class="pill dark">Qualified</span>
          <span class="pill" id="leadHeroAccount">Account 1818 Investments</span>
        </div>
      </div>
      <div class="convert-box">
        <input type="text" placeholder="Try Convert"/>
        <button class="btn outline">Details</button>
      </div>
    </div>
    <div class="lead-panels">
      <article class="lead-panel">
        <header>Contacts</header>
        <p>There are no contacts added so far.</p>
        <p class="muted">Identify and add contacts along with their roles to better qualify this lead.</p>
      </article>
      <article class="lead-panel">
        <header>Products</header>
        <p>There are no products added to this lead yet.</p>
        <p class="muted">Add relevant products to tie this lead based on the prospect's requirements.</p>
      </article>
      <article class="lead-panel team">
        <header>Team</header>
        <div class="team-line">
          <div class="avatar">CK</div>
          <div>
            <div class="team-name">Chandra Kasarabada</div>
            <div class="team-email">chandra.kasarabada@argano.com</div>
            <span class="team-chip">Owner</span>
          </div>
        </div>
        <div class="team-line">
          <div class="avatar light">SN</div>
          <div>
            <div class="team-name">Subash Nagarajan</div>
            <div class="team-email">subash.nagarajan@argano.com</div>
          </div>
        </div>
        <a class="panel-link" href="#">View All Team Members</a>
      </article>
      <article class="lead-panel">
        <header>Opportunities</header>
        <p>There are no opportunities generated from this lead yet.</p>
        <p class="muted">Qualify and convert this lead to view associated opportunities.</p>
      </article>
      <article class="lead-panel activities">
        <header>Activities</header>
        <div class="timeline compact" id="leadTl"></div>
        <a class="panel-link" href="#">View All Activities</a>
      </article>
    </div>
  </section>
</main>

<nav class="app-nav-rail">
  <a href="#">Accounts</a>
  <a href="#">Activities</a>
  <a href="#">Contacts</a>
  <a href="cx_opportunity.html">Opportunities</a>
  <a class="active" href="cx_lead.html">Leads</a>
  <a href="#">Partners</a>
  <a href="#">Partner Contacts</a>
  <a href="#">Express Reports</a>
  <a href="#">Sales Performance</a>
</nav>

<script>
 window.addEventListener('DOMContentLoaded', function(){
   var d = RWD.get();
   var tl = document.getElementById('leadTl');
   function renderTimeline(){
     if(!tl) return;
     tl.innerHTML = '';
     (d.lead.activities||[]).forEach(function(a){
       var div=document.createElement('div');
       div.className='item';
       div.innerHTML='<div class="who">'+a.type+'</div><div class="what">'+a.text+'</div><div class="t">'+a.ts+'</div>';
       tl.appendChild(div);
     });
   }
   renderTimeline();
   setInterval(function(){ var nd=RWD.get(); if((nd.lead.activities||[]).length !== (d.lead.activities||[]).length){ d=nd; renderTimeline(); } }, 800);
   try{
     var hero = document.getElementById('leadHeroTitle');
     if(hero) hero.textContent = (d.lead && (d.lead.name || d.lead.company)) || hero.textContent;
     var acct = document.getElementById('leadHeroAccount');
     if(acct) acct.textContent = (d.lead && d.lead.company) ? 'Account '+d.lead.company : acct.textContent;
   }catch(e){}
   try{ renderLeadsPreview(); }catch(e){}
 });

document.addEventListener('DOMContentLoaded', function(){
  var btn = document.getElementById('add-new-lead-btn'); if(btn) btn.addEventListener('click', openAddLead);
  var form = document.getElementById('addLeadForm');
  if(form){ form.addEventListener('submit', function(ev){ ev.preventDefault();
    try{
      var fd=new FormData(form); var obj={}; fd.forEach(function(v,k){ obj[k]=v; });
      if(window.RWD && typeof RWD.saveLead==='function'){
        RWD.saveLead(obj);
      } else if(window.RWD && typeof RWD.get==='function' && typeof RWD.set==='function'){
        var s=RWD.get(); s.leads=s.leads||[]; s.leads.unshift(obj); s.lead=s.lead||{}; s.lead.activities=s.lead.activities||[];
        s.lead.activities.unshift({ ts:new Date().toLocaleString(), type:'Create', text:'Lead created: '+(obj.name||obj.company||'') });
        try{ RWD.set(s); }catch(e){ console.warn('RWD.set failed', e); }
      }
      if(typeof showToast==='function') showToast('Lead saved'); else alert('Lead saved');
    }catch(e){ console.error('save lead failed', e); if(typeof showToast==='function') showToast('Save failed'); }
  }); }
});

function openAddLead(){
  var card=document.getElementById('lead-form-card');
  if(card){ card.scrollIntoView({behavior:'smooth',block:'start'}); card.classList.add('pulse'); setTimeout(function(){ card.classList.remove('pulse'); }, 900); }
  var first=document.querySelector('#addLeadForm input[name="company"]'); if(first) first.focus();
}
function closeAddLead(){ var card=document.getElementById('lead-form-card'); if(card) card.classList.remove('pulse'); }

function renderLeadsPreview(){
  var container=document.getElementById('leads-preview'); if(!container) return;
  var s=(window.RWD && typeof RWD.get==='function')?RWD.get():null; var leads=(s && s.leads)?s.leads:[];
  var count=document.getElementById('lead-results-count'); if(count) count.textContent=(leads?leads.length:0)+' Results';
  if(!leads || leads.length===0){ container.innerHTML='<div style="color:var(--rw-muted)">No leads yet. Use "Create Lead" to get started.</div>'; return; }
  var html='<table class="table" style="width:100%"><thead><tr><th>Company</th><th>Lead</th><th>Contact</th><th>Owner</th><th style="width:110px">Actions</th></tr></thead><tbody>';
  leads.slice(0,20).forEach(function(l,idx){ html+='<tr><td>'+escapeHtml(l.company||'')+'</td><td>'+escapeHtml(l.name||'')+'</td><td>'+escapeHtml(l.contact||'')+'</td><td>'+escapeHtml(l.owner||'')+'</td><td><button class="btn" onclick="prefillAddLead('+idx+')">Import</button></td></tr>'; });
  html+='</tbody></table>';
  container.innerHTML=html;
}

function prefillAddLead(index){
  var s=(window.RWD && typeof RWD.get==='function')?RWD.get():null; var leads=(s && s.leads)?s.leads:[]; if(!leads || leads.length===0) return;
  var lead=leads[index] || leads[0]; var form=document.getElementById('addLeadForm'); if(!form) return;
  Object.keys(lead).forEach(function(k){ try{ if(form.elements[k]) form.elements[k].value=lead[k]; }catch(e){} });
  openAddLead();
}

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/\'/g,'&#39;'); }

function saveDraft(){ if(typeof showToast==='function') showToast('Draft saved (demo)'); }
function removeDraft(){ if(typeof showToast==='function') showToast('Draft canceled'); }
</script>
<div class="footer">Copyright Demo - Redwood-inspired mockup</div>
</body>
</html>
