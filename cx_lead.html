<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Redwood Lead</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body>

<div class="header"><span class="product">Oracle CX & PPM</span><span class="trail">/ Redwood Demo</span></div>
<div class="shell">
  <div class="tabs">
    <a class="tab" href="index.html">Overview</a>
    <a class="tab" href="sales_cloud.html">Sales Flow</a>
    <a class="tab" href="cx_lead.html">Lead</a>
    <a class="tab" href="cx_opportunity.html">Opportunity</a>
    <a class="tab" href="ppm_pursuit.html">PPM Pursuit</a>
    <a class="tab" href="ppm_construction.html">PPM Construction</a>
    <a class="tab" href="analytics.html">Analytics</a>
    <a class="tab" href="forecasting_pipeline.html">Forecasting</a>
    <a class="tab" href="integration_features.html">Integration</a>
    <a class="tab" href="sales_process_visualization.html">Process Visualization</a>
    <a class="tab" href="results_driven.html">Results Driven</a>
  </div>

<div class="grid">
  <div class="card" style="grid-column:1/2">
    <div class="smartbar">
      <div class="group">
        <button class="btn" onclick="RWD.actLead('Log Call')">Log Call</button>
        <button class="btn" onclick="RWD.actLead('Send Email')">Send Email</button>
        <button class="btn" onclick="RWD.actLead('Schedule Meeting')">Schedule Meeting</button>
        <button class="btn" onclick="RWD.actLead('Create Task')">Create Task</button>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <label for="smart-action-select" class="visually-hidden">Smart Action</label>
        <select id="smart-action-select" style="padding:8px;border-radius:8px;border:1px solid var(--rw-border);background:#fff">
          <option value="">— Smart actions —</option>
          <option>Log Call</option>
          <option>Send Email</option>
          <option>Schedule Meeting</option>
          <option>Create Task</option>
          <option>Create Quote</option>
          <option>Assign Owner</option>
          <option>Add Note</option>
          <option>Create Pursuit</option>
          <option>Push to CPQ</option>
        </select>
        <button type="button" class="btn" id="apply-smart-action">Apply</button>
      </div>
      <div style="position:relative;min-width:260px">
        <input id="smart-action-input" type="search" aria-haspopup="listbox" aria-expanded="false" placeholder="Smart Action… (click to see actions)" style="width:100%;padding:8px;border-radius:8px;border:1px solid var(--rw-border);background:#fff"/>
        <div id="smart-action-pop" class="action-pop" role="listbox" aria-labelledby="smart-action-input" style="display:none"></div>
      </div>
    </div>
    <h2>Lead (Redwood)</h2>
    <div class="body">
      <form id="leadForm" onsubmit="event.preventDefault(); RWD.saveLead(this); RWD.convertToOpportunity(); window.location='cx_opportunity.html';">
        <div class="row">
          <div><label>Company<input name="company" placeholder="Acme Manufacturing" required></label></div>
          <div><label>Primary Contact<input name="contact" placeholder="Jane Smith"></label></div>
        </div>
        <div class="row">
          <div><label>Fit Score<input name="score" type="number" min="0" max="100" value="60"></label></div>
          <div><label>Status<select name="status" disabled><option>Qualified</option></select></label></div>
        </div>
        <div class="actions"><button class="btn primary" type="submit">Qualify → Create Opportunity</button><a class="btn" href="index.html">Back</a></div>
      </form>
    </div>
  </div>
  <div class="card" style="grid-column:2/3">
    <h2>Activity & Timeline</h2>
    <div class="body timeline" id="leadTl"></div>
  </div>
</div>
<script>
 window.addEventListener('DOMContentLoaded', function(){
   var d=RWD.get();
   var tl=document.getElementById('leadTl');
   function render(){ tl.innerHTML=''; (d.lead.activities||[]).forEach(function(a){ var div=document.createElement('div'); div.className='item'; div.innerHTML='<div class="t">'+a.ts+'</div><div><div class="who">'+a.type+'</div><div class="what">'+a.text+'</div></div>'; tl.appendChild(div); }); }
   render();
   // Re-render when actions happen (simple polling for demo)
   setInterval(function(){ var nd=RWD.get(); if((nd.lead.activities||[]).length !== (d.lead.activities||[]).length){ d=nd; render(); } }, 800);
 });
// Smart Action dropdown handler
document.addEventListener('DOMContentLoaded', function(){
  var sel = document.getElementById('smart-action-select');
  var btn = document.getElementById('apply-smart-action');
  var input = document.getElementById('smart-action-input');
  function applySelected(){
    var action = '';
    if(sel && sel.value) action = sel.value;
    if(!action && input && input.value) action = input.value;
    if(!action) return;
    try{
      if(window.RWD && typeof RWD.actLead==='function') RWD.actLead(action);
      if(typeof showToast==='function') showToast('Smart action: '+action+' applied'); else console.log('Smart action:', action);
    }catch(e){ console.warn('applySelected', e); }
    // reset select
    if(sel) sel.selectedIndex = 0;
    if(input) input.value = '';
  }
  if(btn) btn.addEventListener('click', applySelected);
  // allow Enter to trigger when select has focus
  if(sel) sel.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); applySelected(); } });
  // allow Enter to trigger when typing in the input
  if(input) input.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); applySelected(); } });
  // sync input -> select when choosing from datalist
  // Custom popover logic (shows full list on focus/click)
  var pop = document.getElementById('smart-action-pop');
  var actions = [];
  if(sel){ actions = Array.from(sel.options).filter(function(o){ return o.value && o.value.trim(); }).map(function(o){ return o.value; }); }
  function escapeHTML(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/\'/g,'&#39;'); }
  function renderPop(filter){ if(!pop) return; pop.innerHTML=''; var f = (filter||'').toLowerCase().trim(); var shown=0; actions.forEach(function(a,i){ var low = a.toLowerCase(); if(f && low.indexOf(f)===-1) return; var it = document.createElement('div'); it.className='item'; it.setAttribute('role','option'); it.setAttribute('data-value',a); it.tabIndex = 0; if(f && low.indexOf(f)!==-1){ var idx = low.indexOf(f); var before = a.slice(0,idx); var match = a.slice(idx, idx+f.length); var after = a.slice(idx+f.length); it.innerHTML = escapeHTML(before) + '<mark>' + escapeHTML(match) + '</mark>' + escapeHTML(after); } else { it.textContent = a; }
      it.addEventListener('click', function(){ input.value = a; if(sel) sel.value = a; applySelected(); hidePop(); }); it.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); input.value=a; if(sel) sel.value=a; applySelected(); hidePop(); } if(e.key==='ArrowDown'){ var nx = it.nextElementSibling; if(nx) nx.focus(); } if(e.key==='ArrowUp'){ var px = it.previousElementSibling; if(px) px.focus(); } }); pop.appendChild(it); shown++; }); if(shown===0){ var none = document.createElement('div'); none.className='no-results'; none.textContent='No matching actions'; pop.appendChild(none); }
    }
  function showPop(){ if(!pop) return; renderPop(input.value); pop.style.display='block'; input.setAttribute('aria-expanded','true'); document.addEventListener('click', onDocClick); }
  function hidePop(){ if(!pop) return; pop.style.display='none'; input.setAttribute('aria-expanded','false'); document.removeEventListener('click', onDocClick); }
  function onDocClick(e){ if(!pop) return; if(e.target === input) return; if(pop.contains(e.target)) return; hidePop(); }
  if(input){ input.addEventListener('focus', showPop); input.addEventListener('click', function(e){ e.stopPropagation(); showPop(); }); input.addEventListener('input', function(){ renderPop(input.value); }); input.addEventListener('keydown', function(e){ if(e.key==='ArrowDown'){ var first = pop && pop.querySelector('.item'); if(first) { first.focus(); e.preventDefault(); } } if(e.key==='Escape'){ hidePop(); } }); }
});
</script>
<div class="footer">© Demo – Redwood-inspired mockup</div></div>
</body>
</html>