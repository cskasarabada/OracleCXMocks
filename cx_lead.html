<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Argano Lead Workspace</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body class="lead-landing">

<header class="miconnex-bar">
  <div class="logo-mark"><span class="logo-strong">Mi</span>CONNEX</div>
  <div class="bar-actions">
    <button class="ghost-btn small">Help</button>
    <button class="ghost-btn small">Support</button>
    <div class="avatar-chip">CK</div>
  </div>
</header>

<main class="lead-shell">
  <nav class="quick-nav" aria-label="Experience navigation">
    <a href="index.html">Overview</a>
    <a href="Easy_Start_Flows.html">Easy Start</a>
    <a href="sales_cloud.html">Sales Flow</a>
    <a class="active" href="cx_lead.html">Lead</a>
    <a href="cx_opportunity.html">Opportunity</a>
    <a href="ppm_pursuit.html">PPM Pursuit</a>
    <a href="ppm_construction.html">PPM Construction</a>
    <a href="analytics.html">Analytics</a>
    <a href="forecasting_pipeline.html">Forecasting</a>
    <a href="integration_features.html">Integration</a>
    <a href="sales_process_visualization.html">Process Visualization</a>
    <a href="results_driven.html">Results Driven</a>
    <a href="quick_sales_screen.html" class="accent">Quick Sales Screen</a>
  </nav>

  <section class="lead-create-row">
    <article class="lead-list-card">
      <div class="list-header">
        <div>
          <p class="eyebrow">My Open Leads</p>
          <h1>Lead Workspace</h1>
          <p class="muted">Try searching by keyword or add a filter</p>
        </div>
        <div class="list-actions">
          <span class="filter-chip">Status (3)</span>
          <span class="filter-chip">Record Set (Own)</span>
          <button class="ghost-btn" id="add-new-lead-btn">Create Lead</button>
        </div>
      </div>
      <div class="filter-bar">
        <input type="search" placeholder="Search leads"/>
        <button class="ghost-btn">Add Filter</button>
      </div>
      <div class="results-meta" id="lead-results-count">0 Results</div>
      <div id="leads-preview" class="table-shell"></div>
    </article>

    <article class="lead-activity-card">
      <div class="lead-form-header">
        <h2>Activity</h2>
        <p class="muted">Recent updates for your active lead.</p>
      </div>
      <div class="timeline compact tall" id="leadTlMain"></div>
      <a class="panel-link" href="#">View Activity Log</a>
    </article>
  </section>

  <section class="lead-overview">
    <div class="lead-hero-card">
      <div>
        <p class="eyebrow">My Open Leads</p>
        <h2 id="leadHeroTitle">Sample Test Lead - 20250910</h2>
        <div class="hero-meta">
          <span class="pill dark">Qualified</span>
          <span class="pill" id="leadHeroAccount">Account 1818 Investments</span>
        </div>
      </div>
      <div class="convert-box">
        <input type="text" placeholder="Try Convert"/>
        <button class="btn outline">Details</button>
      </div>
    </div>
    <div class="lead-panels">
      <article class="lead-panel">
        <header>Contacts</header>
        <p>There are no contacts added so far.</p>
        <p class="muted">Identify and add contacts along with their roles to better qualify this lead.</p>
      </article>
      <article class="lead-panel">
        <header>Products</header>
        <p>There are no products added to this lead yet.</p>
        <p class="muted">Add relevant products to tie this lead based on the prospect's requirements.</p>
      </article>
      <article class="lead-panel team">
        <header>Team</header>
        <div class="team-line">
          <div class="avatar">CK</div>
          <div>
            <div class="team-name">Chandra Kasarabada</div>
            <div class="team-email">chandra.kasarabada@argano.com</div>
            <span class="team-chip">Owner</span>
          </div>
        </div>
        <div class="team-line">
          <div class="avatar light">SN</div>
          <div>
            <div class="team-name">Subash Nagarajan</div>
            <div class="team-email">subash.nagarajan@argano.com</div>
          </div>
        </div>
        <a class="panel-link" href="#">View All Team Members</a>
      </article>
      <article class="lead-panel">
        <header>Opportunities</header>
        <p>There are no opportunities generated from this lead yet.</p>
        <p class="muted">Qualify and convert this lead to view associated opportunities.</p>
      </article>
    </div>
  </section>
</main>

<div id="lead-modal" class="lead-overlay" aria-hidden="true">
  <div class="lead-modal-card" role="dialog" aria-modal="true" aria-labelledby="leadModalTitle" tabindex="-1">
    <div class="lead-modal-header">
      <div>
        <p class="eyebrow">Create Lead</p>
        <h2 id="leadModalTitle">Primary Contact - Related Contacts</h2>
      </div>
      <button class="ghost-btn small" type="button" onclick="closeAddLead()">Close ✕</button>
    </div>
    <div class="smartbar lead-smart">
      <div class="group">
        <button class="btn" onclick="RWD.actLead('Log Call')">Log Call</button>
        <button class="btn" onclick="RWD.actLead('Send Email')">Send Email</button>
        <button class="btn" onclick="RWD.actLead('Schedule Meeting')">Schedule Meeting</button>
        <button class="btn" onclick="RWD.actLead('Create Task')">Create Task</button>
      </div>
      <div class="smart-select">
        <label for="smart-action-select" class="visually-hidden">Smart Action</label>
        <select id="smart-action-select">
          <option value="">- Smart actions -</option>
          <option>Log Call</option>
          <option>Send Email</option>
          <option>Schedule Meeting</option>
          <option>Create Task</option>
          <option>Create Quote</option>
          <option>Assign Owner</option>
          <option>Add Note</option>
          <option>Create Pursuit</option>
          <option>Push to CPQ</option>
        </select>
        <button type="button" class="btn" id="apply-smart-action">Apply</button>
      </div>
      <div class="smart-input">
        <input id="smart-action-input" type="search" aria-haspopup="listbox" aria-expanded="false" placeholder="Smart Action (click to browse)"/>
        <div id="smart-action-pop" class="action-pop" role="listbox" aria-labelledby="smart-action-input" style="display:none"></div>
      </div>
    </div>

    <form id="addLeadForm" class="lead-form">
      <div class="row">
        <label>Company<input name="company" required></label>
        <label>Lead Name<input name="name"></label>
      </div>
      <div class="row">
        <label>Primary Contact<input name="contact"></label>
        <label>Job Title<input name="title"></label>
      </div>
      <div class="row">
        <label>Contact Phone<input name="phone"></label>
        <label>Contact Email<input name="email" type="email"></label>
      </div>
      <div class="row">
        <label>Source<input name="source"></label>
        <label>Owner<input name="owner" value="Chandra Kasarabada"></label>
      </div>
      <div class="row">
        <label>Fit Score<input name="score" type="number" min="0" max="100" value="60"></label>
        <label>Status<select name="status"><option>Qualified</option><option>Unqualified</option><option>Working</option></select></label>
      </div>
      <div class="row">
        <label>Country<input name="country"></label>
        <label>Rank<input name="rank"></label>
      </div>
      <div class="row">
        <label>Address Line 1<input name="address1"></label>
        <label>Address Line 2<input name="address2"></label>
      </div>
      <div class="row">
        <label>City<input name="city"></label>
        <label>State<input name="state"></label>
      </div>
      <div class="actions">
        <button class="btn primary" type="submit">Save Lead</button>
        <button class="btn" type="button" onclick="closeAddLead()">Cancel</button>
      </div>
    </form>
  </div>
</div>

<nav class="app-nav-rail"><div class="app-nav-items"></div></nav>

<script>
 window.addEventListener('DOMContentLoaded', function(){
   var d = RWD.get();
   var timelineTargets=[document.getElementById('leadTlMain')];
   function renderTimeline(){
     timelineTargets.forEach(function(tl){
       if(!tl) return;
       tl.innerHTML = '';
       (d.lead.activities||[]).forEach(function(a){
         var div=document.createElement('div');
         div.className='item';
         div.innerHTML='<div class="who">'+a.type+'</div><div class="what">'+a.text+'</div><div class="t">'+a.ts+'</div>';
         tl.appendChild(div);
       });
     });
   }
   renderTimeline();
   setInterval(function(){ var nd=RWD.get(); if((nd.lead.activities||[]).length !== (d.lead.activities||[]).length){ d=nd; renderTimeline(); } }, 800);
   try{
     var hero = document.getElementById('leadHeroTitle');
     if(hero) hero.textContent = (d.lead && (d.lead.name || d.lead.company)) || hero.textContent;
     var acct = document.getElementById('leadHeroAccount');
     if(acct) acct.textContent = (d.lead && d.lead.company) ? 'Account '+d.lead.company : acct.textContent;
   }catch(e){}
   try{ renderLeadsPreview(); }catch(e){}
 });

document.addEventListener('DOMContentLoaded', function(){
  var btn = document.getElementById('add-new-lead-btn'); if(btn) btn.addEventListener('click', openAddLead);
  var form = document.getElementById('addLeadForm');
  if(form){ form.addEventListener('submit', function(ev){ ev.preventDefault();
    try{
      var fd=new FormData(form); var obj={}; fd.forEach(function(v,k){ obj[k]=v; });
      if(window.RWD && typeof RWD.saveLead==='function'){
        RWD.saveLead(obj);
      } else if(window.RWD && typeof RWD.get==='function' && typeof RWD.set==='function'){
        var s=RWD.get(); s.leads=s.leads||[]; s.leads.unshift(obj); s.lead=s.lead||{}; s.lead.activities=s.lead.activities||[];
        s.lead.activities.unshift({ ts:new Date().toLocaleString(), type:'Create', text:'Lead created: '+(obj.name||obj.company||'') });
        try{ RWD.set(s); }catch(e){ console.warn('RWD.set failed', e); }
      }
      if(typeof showToast==='function') showToast('Lead saved'); else alert('Lead saved');
    }catch(e){ console.error('save lead failed', e); if(typeof showToast==='function') showToast('Save failed'); }
  }); }
  var overlay=document.getElementById('lead-modal');
  if(overlay){ overlay.addEventListener('click', function(ev){ if(ev.target===overlay) closeAddLead(); }); }
});

function openAddLead(){
  var modal=document.getElementById('lead-modal');
  if(modal){
    modal.style.display='flex';
    modal.setAttribute('aria-hidden','false');
    document.body.classList.add('modal-visible');
    var first=modal.querySelector('#addLeadForm input[name="company"]'); if(first) first.focus();
  }
}
function closeAddLead(){
  var modal=document.getElementById('lead-modal');
  if(modal){
    modal.style.display='none';
    modal.setAttribute('aria-hidden','true');
    document.body.classList.remove('modal-visible');
  }
}

function renderLeadsPreview(){
  var container=document.getElementById('leads-preview'); if(!container) return;
  var s=(window.RWD && typeof RWD.get==='function')?RWD.get():null; var leads=(s && s.leads)?s.leads:[];
  var sampleFallback=sampleLeadData();
  var useSample=!leads || leads.length===0;
  var rows = useSample ? sampleFallback : leads.slice(0);
  window._leadPreviewRows = rows.slice(0);
  var count=document.getElementById('lead-results-count'); if(count) count.textContent=rows.length+' Results'+(useSample?' · Sample Data':'');
  if(rows.length===0){ container.innerHTML='<div style="color:var(--rw-muted)">No leads yet. Use "Create Lead" to get started.</div>'; return; }
  var html='<table class="table" style="width:100%"><thead><tr><th>Company</th><th>Lead</th><th>Contact</th><th>Owner</th><th style="width:160px">Actions</th></tr></thead><tbody>';
  rows.slice(0,20).forEach(function(l,idx){ html+='<tr><td>'+escapeHtml(l.company||'')+'</td><td>'+escapeHtml(l.name||'')+'</td><td>'+escapeHtml(l.contact||'')+'</td><td>'+escapeHtml(l.owner||'')+'</td><td><button class="btn" onclick="prefillAddLead('+idx+')">Import</button><button class="ghost-btn" style="margin-left:6px" onclick="useLeadStory('+idx+')">Use Story</button></td></tr>'; });
  html+='</tbody></table>';
  container.innerHTML=html;
}

function prefillAddLead(index){
  var rows=getLeadRows();
  if(!rows || !rows.length) return;
  var lead=rows[index] || rows[0]; var form=document.getElementById('addLeadForm'); if(!form) return;
  Object.keys(lead).forEach(function(k){ try{ if(form.elements[k]) form.elements[k].value=lead[k]; }catch(e){} });
  openAddLead();
}

function useLeadStory(index){
  var rows=getLeadRows();
  if(!rows || !rows.length) return;
  var lead=rows[index] || rows[0];
  if(window.RWD && typeof RWD.adoptLeadStory==='function'){
    RWD.adoptLeadStory(lead);
    renderLeadsPreview();
    if(typeof showToast==='function') showToast('Story activated for '+(lead.company||''));
  }
}

function getLeadRows(){
  if(Array.isArray(window._leadPreviewRows) && window._leadPreviewRows.length){ return window._leadPreviewRows.slice(0); }
  var s=(window.RWD && typeof RWD.get==='function')?RWD.get():null; var leads=(s && s.leads)?s.leads:[]; 
  if(leads && leads.length) return leads.slice(0);
  return sampleLeadData();
}

function sampleLeadData(){
  return [
    {company:'1818 Investments', name:'South Campus Refresh', contact:'Ravi Patel', owner:'Chandra Kasarabada', leadStatus:'Working', opportunity:'1818 Campus Refresh', opportunityStage:'Qualification', amount:985000, pursuitStatus:'Draft', project:'1818 Campus Delivery', projectStatus:'Planning'},
    {company:'Village of Fox Crossing', name:'Fox Crossing Expansion', contact:'Maria Davis', owner:'Subash Nagarajan', leadStatus:'Qualified', opportunity:'Fox Crossing Utility Upgrade', opportunityStage:'Evaluation', amount:1340000, pursuitStatus:'Costing', project:'Fox Crossing Delivery', projectStatus:'Planning'},
    {company:'Warner Design Associates Inc.', name:'Warner Mixed Use', contact:'Priya Shah', owner:'Chandra Kasarabada', leadStatus:'Qualified', opportunity:'Warner Mixed Use Redevelopment', opportunityStage:'Proposal', amount:980000, pursuitStatus:'Submitted', project:'Warner Redevelopment Build', projectStatus:'Planning'},
    {company:'Excel Engineering Inc.', name:'Excel Modernization', contact:'Derrick Owens', owner:'Subash Nagarajan', leadStatus:'New', opportunity:'Excel Modernization CX', opportunityStage:'Qualification', amount:720000, pursuitStatus:'Draft', project:'Excel CX Delivery', projectStatus:'Planning'}
  ];
}

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/\'/g,'&#39;'); }

function saveDraft(){ if(typeof showToast==='function') showToast('Draft saved (demo)'); }
function removeDraft(){ if(typeof showToast==='function') showToast('Draft canceled'); }
</script>
<div class="footer">Copyright Demo - Redwood-inspired mockup</div>
</body>
</html>
