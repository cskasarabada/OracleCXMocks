<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MiConnex Opportunity</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body class="oppty-landing">

<header class="miconnex-bar">
  <div class="logo-mark"><span class="logo-strong">Mi</span>CONNEX</div>
  <div class="bar-actions">
    <button class="ghost-btn small">Help</button>
    <button class="ghost-btn small">Support</button>
    <div class="avatar-chip">GS</div>
  </div>
</header>

<main class="oppty-shell">
  <nav class="quick-nav" aria-label="Experience navigation">
    <a href="index.html">Overview</a>
    <a href="Easy_Start_Flows.html">Easy Start</a>
    <a href="sales_cloud.html">Sales Flow</a>
    <a href="cx_lead.html">Lead</a>
    <a class="active" href="cx_opportunity.html">Opportunity</a>
    <a href="ppm_pursuit.html">PPM Pursuit</a>
    <a href="ppm_construction.html">PPM Construction</a>
    <a href="analytics.html">Analytics</a>
    <a href="forecasting_pipeline.html">Forecasting</a>
    <a href="integration_features.html">Integration</a>
    <a href="sales_process_visualization.html">Process Visualization</a>
    <a href="results_driven.html">Results Driven</a>
    <a href="quick_sales_screen.html" class="accent">Quick Sales Screen</a>
  </nav>
  <div class="crumbs">
    <div class="crumb-label">My Open Opportunities</div>
    <div class="crumb-actions">
      <button class="ghost-icon" aria-label="Previous opportunity">&larr;</button>
      <button class="ghost-icon" aria-label="Next opportunity">&rarr;</button>
      <button class="btn outline">Details</button>
    </div>
  </div>

  <section class="opps-preview-card">
    <div class="card-header">
      <div>
        <h3>My Open Opportunities</h3>
        <div class="card-sub">Try searching by keyword or add a filter</div>
      </div>
      <span class="results-count" id="opps-count-label">Results</span>
    </div>
    <div id="opps-preview" class="table-shell"></div>
  </section>

  <section class="oppty-hero-card">
    <div class="hero-content">
      <div class="hero-heading">
        <div class="hero-title-line">
          <h1 class="hero-title" id="opptyHeroTitle">TT1 eea</h1>
          <button class="favorite-btn" aria-label="Favorite">&#9825;</button>
        </div>
        <div class="hero-sub" id="opptyHeroSub">Account &bull; Primary Contact</div>
      </div>
      <div class="stage hero-stage">
        <span class="s cur" data-v="Qualification">Statement of Qualification</span>
        <span class="s" data-v="Evaluation">Evaluation</span>
        <span class="s" data-v="Proposal">Proposal</span>
        <span class="s" data-v="Negotiation">Negotiation</span>
        <span class="s" data-v="Closed Won">Closed Won</span>
      </div>
      <div class="info-pills">
        <div class="info-pill">Status Open</div>
        <div class="info-pill">Win Probability 40</div>
        <div class="info-pill pill-long">Account Warner Design Associates Inc.</div>
        <div class="info-pill pill-long">Owner Chandra Kasarabada</div>
        <div class="info-pill">Opportunity Number 42048</div>
      </div>
      <div class="hero-cta">
        <button class="btn brand" id="add-new-oppty-btn">Create Opportunity</button>
      </div>
    </div>
    <div class="hero-actions">
      <button class="ghost-icon">Share</button>
      <button class="ghost-icon">Sync</button>
      <button class="ghost-icon">Email</button>
      <button class="btn primary">Details</button>
    </div>
  </section>

  <section class="panel-grid">
    <article class="panel-card">
      <header>Contacts</header>
      <p>There are no contacts added for this opportunity yet.</p>
      <p class="muted">As contacts are added, you can view them here.</p>
    </article>
    <article class="panel-card">
      <header>Team</header>
        <div class="team-card">
        <div class="avatar">CK</div>
        <div>
          <div class="team-name">Chandra Kasarabada</div>
          <div class="team-email">chandra.Kasarabada@argano.com</div>
          <span class="team-chip">Owner</span>
        </div>
      </div>
      <a class="panel-link" href="#">View All Team Members (1)</a>
    </article>
    <article class="panel-card project-card">
      <header>Project</header>
      <p>Keep the commercial team aligned with project delivery.</p>
      <button class="btn brand" id="btnCreatePursuit" type="button">Navigate to PPM</button>
      <div class="project-progress">
        <div class="status-pill" id="status">Idle</div>
        <div class="progress"><div class="bar" id="prog"></div></div>
      </div>
    </article>
    <article class="panel-card">
      <header>Partners</header>
      <p>There are no partners assigned for this opportunity yet.</p>
      <p class="muted">As partners are assigned, you can view them here.</p>
    </article>
    <article class="panel-card">
      <header>Competitors</header>
      <p>There are no competitors identified yet.</p>
      <p class="muted">As competitors are identified, you can view them here and track their relevant threat levels here.</p>
    </article>
  </section>

  <div class="carousel-dots" role="presentation">
    <span class="dot active"></span>
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
    <span class="dot"></span>
  </div>

  <div class="sr-only">
    <div class="timeline" id="opptyTl"></div>
  </div>

  <form id="oppForm" class="sr-only">
    <input name="name" id="opptyName"/>
    <input name="amount" id="opptyAmount" type="number"/>
    <input type="hidden" name="stage" id="stageVal" value="Qualification"/>
  </form>

</main>

<nav class="app-nav-rail">
  <a href="#">Accounts</a>
  <a href="#">Activities</a>
  <a href="#">Contacts</a>
  <a class="active" href="#">Opportunities</a>
  <a href="#">Leads</a>
  <a href="#">Partners</a>
  <a href="#">Partner Contacts</a>
  <a href="#">Express Reports</a>
  <a href="#">Sales Performance</a>
</nav>

<div id="add-oppty-modal" class="qs-overlay" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;z-index:120" aria-hidden="true">
  <div class="qs-modal lead-modal" role="dialog" aria-modal="true" aria-labelledby="addOpptyTitle" tabindex="-1" style="width:min(760px,94%)">
    <h2 id="addOpptyTitle">Create Opportunity</h2>
    <form id="addOpptyForm">
      <div class="field"><label>Name</label><input name="name" required></div>
      <div class="field"><label>Account</label><input name="account"></div>
      <div class="two-col">
        <div class="field" style="grid-template-columns:1fr"><label>Amount</label><input name="amount" type="number"></div>
        <div class="field" style="grid-template-columns:1fr"><label>Owner</label><input name="owner"></div>
      </div>
      <div class="field"><label>Stage</label><select name="stage"><option>Qualification</option><option>Evaluation</option><option>Proposal</option><option>Negotiation</option><option>Closed Won</option></select></div>
      <div class="field"><label>Notes</label><textarea name="notes" rows="3"></textarea></div>
      <div class="actions">
        <button type="button" class="btn" onclick="closeAddOppty()">Cancel</button>
        <button type="submit" class="btn primary">Save Opportunity</button>
      </div>
    </form>
  </div>
</div>

<script>
 window.addEventListener('DOMContentLoaded', function(){
   var d=RWD.get();
   document.getElementById('opptyName').value=d.oppty.name||'';
   document.getElementById('opptyAmount').value=d.oppty.amount||0;
  // set hero title from demo state if available
  try{ var hero = document.getElementById('opptyHeroTitle'); if(hero) hero.textContent = (d.oppty && (d.oppty.name || d.oppty.title)) || 'Sample Opportunity'; var sub = document.getElementById('opptyHeroSub'); if(sub) sub.textContent = (d.oppty && d.oppty.account) || 'Account - Primary Contact'; }catch(e){}
   function setStage(v){ document.getElementById('stageVal').value=v; Array.prototype.slice.call(document.querySelectorAll('.stage .s')).forEach(function(sp){ sp.classList.toggle('cur', sp.dataset.v===v); }); }
   setStage(d.oppty.stage||'Qualification');
   Array.prototype.slice.call(document.querySelectorAll('.stage .s')).forEach(function(sp){ sp.addEventListener('click', function(){ setStage(sp.dataset.v); }); });
   document.getElementById('btnCreatePursuit').addEventListener('click', function(){ var f=document.getElementById('oppForm'); RWD.saveOppty(f); document.getElementById('status').textContent='Running OIC job...'; document.getElementById('prog').style.width='60%'; RWD.createPursuitViaOIC(function(){ document.getElementById('status').textContent='Completed'; document.getElementById('prog').style.width='100%'; setTimeout(function(){ window.location='ppm_pursuit.html'; }, 600); }); });
   // render timeline
   var tl=document.getElementById('opptyTl');
   function render(){ tl.innerHTML=''; (d.oppty.activities||[]).forEach(function(a){ var div=document.createElement('div'); div.className='item'; div.innerHTML='<div class="t">'+a.ts+'</div><div><div class="who">'+a.type+'</div><div class="what">'+a.text+'</div></div>'; tl.appendChild(div); }); }
   render(); setInterval(function(){ var nd=RWD.get(); if((nd.oppty.activities||[]).length !== (d.oppty.activities||[]).length){ d=nd; render(); } }, 800);
  // render opportunities preview initially
  try{ renderOppsPreview(); }catch(e){}
 });

// Add New Opportunity modal handlers
function openAddOppty(){
  var m = document.getElementById('add-oppty-modal');
  if(window.ModalManager && typeof ModalManager.showModal==='function'){
    try{ ModalManager.showModal('add-oppty-modal'); document.body.classList.add('modal-visible'); return; }catch(e){}
  }
  if(m){
    m.style.display='flex';
    m.setAttribute('aria-hidden','false');
    document.body.classList.add('modal-visible');
    var f = m.querySelector('input[name="name"]'); if(f) f.focus();
  }
}
function closeAddOppty(){
  var m=document.getElementById('add-oppty-modal');
  if(window.ModalManager && typeof ModalManager.closeModal==='function'){
    try{ ModalManager.closeModal('add-oppty-modal'); }catch(e){}
  }
  if(m){ m.style.display='none'; m.setAttribute('aria-hidden','true'); }
  document.body.classList.remove('modal-visible');
}

document.addEventListener('DOMContentLoaded', function(){
  var btn = document.getElementById('add-new-oppty-btn'); if(btn) btn.addEventListener('click', openAddOppty);
  var form = document.getElementById('addOpptyForm'); if(form){ form.addEventListener('submit', function(ev){ ev.preventDefault(); try{ var fd=new FormData(form); var obj={}; fd.forEach(function(v,k){ obj[k]=v; }); if(window.RWD && typeof RWD.saveOppty==='function'){ RWD.saveOppty(obj); } else if(window.RWD && typeof RWD.get==='function' && typeof RWD.set==='function'){ var s = RWD.get(); s.opportunities = s.opportunities || []; s.opportunities.unshift(obj); s.oppty = s.oppty || {}; s.oppty.activities = s.oppty.activities || []; s.oppty.activities.unshift({ ts:new Date().toLocaleString(), type:'Create', text: 'Opportunity created: ' + (obj.name || obj.account || '') }); try{ RWD.set(s); }catch(e){ console.warn('RWD.set failed', e); } }
        if(typeof showToast==='function') showToast('Opportunity saved'); else alert('Opportunity saved');
      }catch(e){ console.error('save oppty failed', e); if(typeof showToast==='function') showToast('Save failed'); }
      closeAddOppty(); try{ renderOppsPreview(); }catch(e){}
  }); }
  // initial preview render
  try{ renderOppsPreview(); }catch(e){}
});

// Render recent opportunities preview
function renderOppsPreview(){
  var container = document.getElementById('opps-preview'); if(!container) return;
  var s = (window.RWD && typeof RWD.get==='function')?RWD.get():null;
  var opps = (s && s.opportunities) ? s.opportunities : [];
  var total = opps ? opps.length : 0;
  var countLabel = document.getElementById('opps-count-label'); if(countLabel) countLabel.textContent = total + ' Results';
  if(!opps || opps.length===0){ container.innerHTML = '<div style="color:var(--rw-muted)">No opportunities yet. Click "Create Opportunity" to add one.</div>'; return; }
  var html='<table class="table" style="width:100%"><thead><tr><th>Name</th><th>Account</th><th>Amount</th><th>Stage</th><th style="width:110px">Actions</th></tr></thead><tbody>';
  opps.slice(0,20).forEach(function(o,idx){
    html += '<tr><td>'+escapeHtml(o.name||'')+'</td><td>'+escapeHtml(o.account||'')+'</td><td>'+(o.amount?('$'+Number(o.amount).toLocaleString()):'')+'</td><td>'+escapeHtml(o.stage||'')+'</td><td><button class="btn" onclick="prefillAddOppty('+idx+')">Import</button></td></tr>';
  });
  html += '</tbody></table>'; container.innerHTML = html;
}

function prefillAddOppty(index){ var s = (window.RWD && typeof RWD.get==='function')?RWD.get():null; var opps = (s && s.opportunities)?s.opportunities:[]; if(!opps || opps.length===0) return; var opp = opps[index] || opps[0]; var form = document.getElementById('addOpptyForm'); if(!form) return; Object.keys(opp).forEach(function(k){ try{ if(form.elements[k]) form.elements[k].value = opp[k]; }catch(e){} }); openAddOppty(); }

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

function saveOppDraft(){ if(typeof showToast==='function') showToast('Draft saved (demo)'); }
function cancelOppDraft(){ if(typeof showToast==='function') showToast('Draft canceled'); }
</script>
<div class="footer">Copyright Demo - Redwood-inspired mockup</div>
</body>
</html>
