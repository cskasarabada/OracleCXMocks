<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPM Construction (Redwood)</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body>

<nav class="quick-nav auto-nav"></nav>
<div class="shell">

<div class="grid">
  <div class="card"><h2>Construction Project</h2><div class="body">
    <div class="kv"><div class="k">Project</div><div class="v" id="cName">—</div></div>
    <div class="kv"><div class="k">Budget</div><div class="v" id="cBudget">—</div></div>
    <table class="table"><thead><tr><th>WBS Code</th><th>Work Package</th></tr></thead><tbody id="wbs"></tbody></table>
    <div class="actions"><button class="btn warn" id="btnComplete">Mark Substantial Completion</button><a class="btn" href="ppm_pursuit.html">Back</a></div>
  </div></div>
  <div class="card"><h2>Warranty</h2><div class="body">
    <div class="kv"><div class="k">Start</div><div class="v" id="wStart">—</div></div>
    <div class="kv"><div class="k">End</div><div class="v" id="wEnd">—</div></div>
  </div></div>
</div>
<section class="smart-banner" id="project-smart-banner">
  <div>
    <p class="eyebrow">Smart Actions</p>
    <h3>Field + back-office collaboration</h3>
    <p>Coordinate updates, punch lists, and warranty prep for <strong id="project-smart-name">this project</strong>.</p>
  </div>
  <div class="actions">
    <div class="pill-row">
      <button type="button" class="btn" data-project-action="Send Progress Update">Send Progress Update</button>
      <button type="button" class="btn" data-project-action="Request Change Order">Request Change Order</button>
      <button type="button" class="btn" data-project-action="Notify Warranty Team">Notify Warranty Team</button>
      <button type="button" class="btn" data-project-action="Sync Actuals">Sync Actuals</button>
    </div>
    <div class="action-block">
      <label class="visually-hidden" for="project-smart-select">Smart Actions</label>
      <select id="project-smart-select">
        <option value="">- Select Smart Action -</option>
        <option>Send Progress Update</option>
        <option>Request Change Order</option>
        <option>Notify Warranty Team</option>
        <option>Sync Actuals</option>
        <option>Share Lessons Learned</option>
      </select>
      <button type="button" class="btn" id="project-smart-apply">Apply</button>
    </div>
  </div>
</section>
<script>
 window.addEventListener('DOMContentLoaded', function(){
   var d=RWD.get();
   document.getElementById('cName').textContent=d.const.name||'-';
   document.getElementById('cBudget').textContent='$'+Number(d.const.budget||0).toLocaleString();
   var smartLabel=document.getElementById('project-smart-name'); if(smartLabel) smartLabel.textContent=d.const.name||'this project';
   initProjectSmartBanner();
   var body=document.getElementById('wbs');
   ['1.0 Mobilization','2.0 Site Work','3.0 Structure'].forEach(function(row){
     var parts=row.split(' ');
     var tr=document.createElement('tr');
     tr.innerHTML='<td>'+parts[0]+'</td><td>'+parts.slice(1).join(' ')+'</td>';
     body.appendChild(tr);
   });
   document.getElementById('btnComplete').addEventListener('click', function(){
     RWD.completeSubstantial(function(){
       var s=new Date();
       var e=new Date(s.getFullYear()+1,s.getMonth(),s.getDate());
       document.getElementById('wStart').textContent=s.toLocaleDateString();
       document.getElementById('wEnd').textContent=e.toLocaleDateString();
     });
   });
 });
function initProjectSmartBanner(){
  var buttons=document.querySelectorAll('[data-project-action]');
  buttons.forEach(function(btn){
    btn.addEventListener('click', function(){ fireProjectAction(btn.dataset.projectAction || btn.textContent); });
  });
  var select=document.getElementById('project-smart-select');
  var apply=document.getElementById('project-smart-apply');
  if(apply){ apply.addEventListener('click', function(){ if(select) fireProjectAction(select.value); }); }
}
function fireProjectAction(action){
  if(!action) return;
  if(window.RWD && typeof RWD.actProject==='function'){ RWD.actProject(action); }
  if(typeof showToast==='function') showToast(action+' triggered');
}
</script>
<div class="footer">© Demo – Redwood-inspired mockup</div></div>
</body>
</html>
