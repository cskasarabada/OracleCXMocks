<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PPM Pursuit (Redwood)</title>
<link rel="stylesheet" href="assets/redwood.css"/>
<script defer src="assets/app.js"></script>
</head>
<body>

<nav class="quick-nav auto-nav"></nav>
<div class="shell">

<div class="grid">
  <div class="card"><h2>PPM Pursuit</h2><div class="body">
    <form id="purForm">
      <div class="row">
        <div><label>Project Name<input name="name" id="purName"></label></div>
        <div><label>Estimate (USD)<input name="estimate" id="purEstimate" type="number"></label></div>
      </div>
      <div class="actions">
        <button class="btn ok" id="btnAward">Award / Create Construction (OIC)</button>
        <a class="btn" href="cx_opportunity.html">Back</a>
      </div>
    </form>
  </div></div>
  <div class="card"><h2>Status</h2><div class="body">
    <div class="kv"><div class="k">State</div><div class="v" id="purState">Draft</div></div>
    <div class="progress"><div class="bar" id="purProg"></div></div>
  </div></div>
</div>
<section class="smart-banner" id="pursuit-smart-banner">
  <div>
    <p class="eyebrow">Smart Actions</p>
    <h3>Keep pursuit tasks moving</h3>
    <p>Trigger estimating, resource requests, and integration syncs for <strong id="pursuit-smart-name">this pursuit</strong>.</p>
  </div>
  <div class="actions">
    <div class="pill-row">
      <button type="button" class="btn" data-pursuit-action="Request Estimate">Request Estimate</button>
      <button type="button" class="btn" data-pursuit-action="Assign Resources">Assign Resources</button>
      <button type="button" class="btn" data-pursuit-action="Sync to CX">Sync to CX</button>
      <button type="button" class="btn" data-pursuit-action="Share Status">Share Status</button>
    </div>
    <div class="action-block">
      <label class="visually-hidden" for="pursuit-smart-select">Smart Actions</label>
      <select id="pursuit-smart-select">
        <option value="">- Select Smart Action -</option>
        <option value="Request Estimate">Request Estimate</option>
        <option value="Assign Resources">Assign Resources</option>
        <option value="Sync to CX">Sync to CX</option>
        <option value="Share Status">Share Status</option>
        <option value="Trigger Doc Review">Trigger Doc Review</option>
      </select>
      <button type="button" class="btn" id="pursuit-smart-apply">Apply</button>
    </div>
  </div>
</section>
<script>
 window.addEventListener('DOMContentLoaded', function(){
  var d=RWD.get();
  document.getElementById('purName').value=d.pursuit.name||'';
  document.getElementById('purEstimate').value=d.pursuit.estimate||0;
  var smartLabel=document.getElementById('pursuit-smart-name'); if(smartLabel) smartLabel.textContent=d.pursuit.name||'this pursuit';
  document.getElementById('purState').textContent=d.pursuit.status || 'Draft';
  document.getElementById('purProg').style.width=(d.pursuit.status==='Awarded'? '100%' : '40%');
  initPursuitSmartBanner();
  document.getElementById('btnAward').addEventListener('click', function(e){
     e.preventDefault();
     RWD.savePursuit(document.getElementById('purForm'));
     document.getElementById('purState').textContent='Award in progress…';
     document.getElementById('purProg').style.width='60%';
     RWD.awardToConstruction(function(){
       document.getElementById('purState').textContent='Awarded';
       document.getElementById('purProg').style.width='100%';
       setTimeout(function(){ window.location='ppm_construction.html'; }, 600);
     });
 });
});
function initPursuitSmartBanner(){
  var buttons=document.querySelectorAll('[data-pursuit-action]');
  buttons.forEach(function(btn){
    btn.addEventListener('click', function(){ firePursuitAction(btn.dataset.pursuitAction || btn.textContent); });
  });
  var select=document.getElementById('pursuit-smart-select');
  var apply=document.getElementById('pursuit-smart-apply');
  if(apply){ apply.addEventListener('click', function(){ if(select) firePursuitAction(select.value); }); }
}
function firePursuitAction(action){
  if(!action) return;
  if(window.RWD && typeof RWD.actPursuit==='function'){ RWD.actPursuit(action); }
  if(typeof showToast==='function') showToast(action+' triggered');
}
</script>
<div class="footer">© Demo – Redwood-inspired mockup</div></div>
</body>
</html>
